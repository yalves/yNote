<!DOCTYPE html>
<html lang="en" class="no-js">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
		<title>Why note API Client</title>
        <link href="css/bootstrap-theme.css" rel="stylesheet" />
        <link href="css/bootstrap.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/default.css" />
		<link rel="stylesheet" type="text/css" href="css/component.css" />
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<script src="js/modernizr.custom.js"></script>
	</head>
	<body class="nl-blurred" onload="PopularSelects()">
		<div class="container demo-1">
			<!-- Top Navigation -->
			<div class="main clearfix">
				<form id="nl-form" class="nl-form">
					Gostaria de ver as tarefas com a categoria
					<select id="select-categorias">
					</select>
					<br />e que possuem a tag
					<select id="select-tags">
					</select>
					<div class="nl-submit-wrap">
						<button class="nl-submit" type="button" onclick="ObterTarefasFiltradas()">Filtrar tarefas</button>
					</div>
					<div class="nl-overlay"></div>
				</form>
			</div>		
			<div id="container-tarefas" class="col-xs-10 col-xs-offset-1" style="margin-bottom: 40px">
					<div class="table-responsive">
						<table class="table" style="margin-top: 40px">
							<thead style="font-size: 25px">
								<tr>
									<th>
										Titulo
									</th>
									<th>
										Conteudo
									</th>
									<th>
										Id do usuário
									</th>
									<th>
										Criação
									</th>
									<th>
										Prazo
									</th>
									<th>
										Id da categoria
									</th>
								</tr>
							</thead>
							<tbody id="table-body">
							</tbody>						
						</table>
					</div>				
				</div>	
		</div><!-- /container -->
		<script src="js/nlform.js"></script>
		<script>
            function CriarForm()
            {
                var nlform = new NLForm(document.getElementById('nl-form'));
            }

			function PopularSelects()
			{
				$('#container-tarefas').hide();
				$('#select-tags').empty();
				$('#select-categorias').empty();
				$.ajax({
						type: "get",
						url: "http://whynoteapi.azurewebsites.net//v1/Tags/ObterTags",						
						success: function(data){
							// Parse the returned json data
							//var opts = $.parseJSON(data);
							// Use jQuery's each to iterate over the opts value
							$.each(data, function(i, d) {
								// You will need to alter the below to get the right values from your json object.  Guessing that d.id / d.modelName are columns in your carModels data
                                //$('#select-tags').append('<option value="' + d.TagId + '">' + d.Titulo + '</option>');

                                var opt = document.createElement('option');
                                opt.innerHTML = d.Titulo;
                                opt.value = d.TagId;
                                document.getElementById('select-tags').appendChild(opt);
							});
						}
					});

				$.ajax({
						type: "get",
						url: "http://whynoteapi.azurewebsites.net//v1/Categorias/ObterCategorias",						
						success: function(data){
							// Parse the returned json data
							//var opts = $.parseJSON(data);
							// Use jQuery's each to iterate over the opts value
							$.each(data, function(i, d) {
								// You will need to alter the below to get the right values from your json object.  Guessing that d.id / d.modelName are columns in your carModels data
                                //$('#select-categorias').append('<option value="' + d.CategoriaId + '">' + d.Titulo + '</option>');

                                var opt = document.createElement('option');
                                opt.innerHTML = d.Titulo;
                                opt.value = d.CategoriaId;
                                document.getElementById('select-categorias').appendChild(opt);
							});
						}
                });
			}

			function ObterTarefasFiltradas()
			{
				$.ajax({
						type: "get",
						url: "http://whynoteapi.azurewebsites.net//v1/Tarefas/ObterTarefasFiltradas",
						data: 
						{ 
							'categoriaId': $('#select-categorias').val(),
							'tagId' : $('#select-tags').val()
						},
						success: function(data){
							$('#table-body').empty();
							$.each(data, function(i, d) {
								$('#table-body').append('<tr>'
								+ '<td>' + d.Titulo + '</td>'
								+ '<td>' + d.Conteudo + '</td>'
								+ '<td>' + d.UsuarioId + '</td>'
								+ '<td>' + d.DataDeCriacao + '</td>'
								+ '<td>' + d.Prazo + '</td>'
								+ '<td>' + d.CategoriaId + '</td>'
								+ '</tr>');
							});
							$('#container-tarefas').show();
						}
					});
			}			
		</script>

		<script>
			//var nlform = new NLForm( document.getElementById( 'nl-form' ) );
		</script>
	</body>
</html>